<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>[译] RxJS: 别取消订阅 | Rxjs</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="目录">
    <link rel="preload" href="/assets/css/0.styles.ccac5a78.css" as="style"><link rel="preload" href="/assets/js/app.de24a261.js" as="script"><link rel="preload" href="/assets/js/2.f6e3d3ee.js" as="script"><link rel="preload" href="/assets/js/26.60ae3da3.js" as="script"><link rel="prefetch" href="/assets/js/10.157238cf.js"><link rel="prefetch" href="/assets/js/11.41a012c6.js"><link rel="prefetch" href="/assets/js/12.b8086885.js"><link rel="prefetch" href="/assets/js/13.e45c7342.js"><link rel="prefetch" href="/assets/js/14.e3e54685.js"><link rel="prefetch" href="/assets/js/15.9351c89b.js"><link rel="prefetch" href="/assets/js/16.7d3aff72.js"><link rel="prefetch" href="/assets/js/17.cd3a7c14.js"><link rel="prefetch" href="/assets/js/18.7b5bc8d2.js"><link rel="prefetch" href="/assets/js/19.77700336.js"><link rel="prefetch" href="/assets/js/20.ca0fdbb6.js"><link rel="prefetch" href="/assets/js/21.d6bc78c5.js"><link rel="prefetch" href="/assets/js/22.2428074e.js"><link rel="prefetch" href="/assets/js/23.93a777ed.js"><link rel="prefetch" href="/assets/js/24.73aa7224.js"><link rel="prefetch" href="/assets/js/25.e43f6412.js"><link rel="prefetch" href="/assets/js/27.03e00c07.js"><link rel="prefetch" href="/assets/js/28.95c8c079.js"><link rel="prefetch" href="/assets/js/29.eb8ac4a8.js"><link rel="prefetch" href="/assets/js/3.d907f710.js"><link rel="prefetch" href="/assets/js/30.5c09e00d.js"><link rel="prefetch" href="/assets/js/31.962a908d.js"><link rel="prefetch" href="/assets/js/32.c0fe7bdd.js"><link rel="prefetch" href="/assets/js/33.74f04d2b.js"><link rel="prefetch" href="/assets/js/34.20bdc3d5.js"><link rel="prefetch" href="/assets/js/35.d30ab2c2.js"><link rel="prefetch" href="/assets/js/36.d13995e1.js"><link rel="prefetch" href="/assets/js/37.08e1d965.js"><link rel="prefetch" href="/assets/js/38.fae351d3.js"><link rel="prefetch" href="/assets/js/39.a40c9688.js"><link rel="prefetch" href="/assets/js/4.fe9ea34b.js"><link rel="prefetch" href="/assets/js/40.87c8b8ee.js"><link rel="prefetch" href="/assets/js/41.242cc580.js"><link rel="prefetch" href="/assets/js/42.736834a5.js"><link rel="prefetch" href="/assets/js/43.57a7a89e.js"><link rel="prefetch" href="/assets/js/44.2c085c54.js"><link rel="prefetch" href="/assets/js/45.fcfe6221.js"><link rel="prefetch" href="/assets/js/46.31dda88a.js"><link rel="prefetch" href="/assets/js/5.7bdab572.js"><link rel="prefetch" href="/assets/js/6.af184b79.js"><link rel="prefetch" href="/assets/js/7.d5eaab60.js"><link rel="prefetch" href="/assets/js/8.b99143ac.js"><link rel="prefetch" href="/assets/js/9.55a51475.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ccac5a78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Rxjs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/rxjs-docs/home.html" class="nav-link">
  rxjs
</a></div><div class="nav-item"><a href="/articles/home.html" class="nav-link">
  精选文章
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/rxjs-docs/home.html" class="nav-link">
  rxjs
</a></div><div class="nav-item"><a href="/articles/home.html" class="nav-link">
  精选文章
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/articles/home.html" class="sidebar-link">RxJS 优质文章翻译</a></li><li><a href="/articles/articles/ADVANCED-CACHING-WITH-RXJS.html" class="sidebar-link">[译] RxJS 高级缓存</a></li><li><a href="/articles/articles/Angular-Simple-Infinite-Scroller-Directive-With-RxJS-Observables.html" class="sidebar-link">[译] Angular: 使用 RxJS Observables 来实现简易版的无限滚动加载指令</a></li><li><a href="/articles/articles/Debugging-RxJS-Part1-Tooling.html" class="sidebar-link">[译] 调试 RxJS 第1部分: 工具篇</a></li><li><a href="/articles/articles/Debugging-RxJS-Part2-Logging.html" class="sidebar-link">[译] 调试 RxJS 第2部分: 日志篇</a></li><li><a href="/articles/articles/Don't-Unsubscribe.html" aria-current="page" class="active sidebar-link">[译] RxJS: 别取消订阅</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/articles/Don't-Unsubscribe.html#命令式的-subscription-管理看起来应该是怎样的" class="sidebar-link">命令式的 subscription 管理看起来应该是怎样的</a></li><li class="sidebar-sub-header"><a href="/articles/articles/Don't-Unsubscribe.html#使用-takeuntil-来构成你的-subscription-管理" class="sidebar-link">使用 takeUntil 来构成你的 subscription 管理</a></li><li class="sidebar-sub-header"><a href="/articles/articles/Don't-Unsubscribe.html#其他操作符" class="sidebar-link">其他操作符</a></li><li class="sidebar-sub-header"><a href="/articles/articles/Don't-Unsubscribe.html#总结-使用-takeuntil、takewhile-及其他" class="sidebar-link">总结: 使用 takeUntil、takeWhile，及其他</a></li></ul></li><li><a href="/articles/articles/Hot-Vs-Cold-Observables.html" class="sidebar-link">[译] 热的 Vs 冷的 Observables</a></li><li><a href="/articles/articles/How-To-Use-RefCount.html" class="sidebar-link">[译] RxJS: 如何使用 refCount</a></li><li><a href="/articles/articles/Infinite-Scroll-In-Angular-An-RxJS.html" class="sidebar-link">[译] 使用 Angular 和 RxJS 实现的无限滚动加载</a></li><li><a href="/articles/articles/Learn-To-Combine-RxJS-Sequences-With-Super-Intuitive-Interactive-Diagrams.html" class="sidebar-link">[译] RxJS: 使用超直观的交互图来学习组合操作符</a></li><li><a href="/articles/articles/Learning-Observable-By-Building-Observable.html" class="sidebar-link">[译] 通过构建 Observable 来学习 Observable</a></li><li><a href="/articles/articles/Naive-Infinite-Scroll-In-Reactive-Programming-Using-RxJS-Observables.html" class="sidebar-link">[译] 使用响应式编程来实现简易版的无限滚动加载</a></li><li><a href="/articles/articles/On-The-Subject-Of-Subjects.html" class="sidebar-link">[译] 关于 RxJS 中的 Subject</a></li><li><a href="/articles/articles/PRIMER-ON-RXJS-SCHEDULERS.html" class="sidebar-link">[译] RxJS 调度器入门</a></li><li><a href="/articles/articles/Reactive-Brain-Waves.html" class="sidebar-link">[译] 响应式脑电波</a></li><li><a href="/articles/articles/RxJS-Observable-Interop-With-Promises-And-Async-Await.html" class="sidebar-link">[译] RxJS Observable 与 Promises 和 Async-Await 交互</a></li><li><a href="/articles/articles/Six-Operators-That-You-Must-Know.html" class="sidebar-link">[译] RxJS: 6个你必须知道的操作符</a></li><li><a href="/articles/articles/Subjects-For-Human-Beings.html" class="sidebar-link">[译] RxJS: 白话 Subjects</a></li><li><a href="/articles/articles/TAMING-SNAKES-WITH-REACTIVE-STREAMS.html" class="sidebar-link">[译] RxJS 游戏之贪吃蛇</a></li><li><a href="/articles/articles/Testing-Race-Conditions-Using-RxJS-Marbles.html" class="sidebar-link">[译] RxJS 进阶技巧: 使用 RxJS Marbles 测试竞争条件</a></li><li><a href="/articles/articles/Understanding-Subjects-in-RxJS.html" class="sidebar-link">[译] 理解 RxJS 中 Subjects</a></li><li><a href="/articles/articles/Understanding-The-Publish-And-Share-Operators.html" class="sidebar-link">[译] RxJS: 理解 publish 和 share 操作符</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="译-rxjs-别取消订阅"><a href="#译-rxjs-别取消订阅" class="header-anchor">#</a> [译] RxJS: 别取消订阅</h1> <blockquote><p>原文链接: <a href="https://medium.com/@benlesh/rxjs-dont-unsubscribe-6753ed4fda87" target="_blank" rel="noopener noreferrer">https://medium.com/@benlesh/rxjs-dont-unsubscribe-6753ed4fda87<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>好吧...，只是不要过多地使用取消订阅操作。</p> <blockquote><p>译者注: Ben 也当了回标题党 (￣▽￣)&quot;</p></blockquote> <p>我经常受邀去帮助他人调试他们的 RxJS 代码的问题，或者弄清楚如何构建一个大量使用 RxJS 的异步操作的应用。当这么做的时候，我通常都会看到同样的问题一遍又一遍反复地出现，人们维护大量的 subscription 对象及其处理方法。开发者会一成不变地使用一个 Observable 发起3个 HTTP 请求，然后保留3个 subscription 对象，当某个事件发生时，会调用事件所对应的 subscription 对象。</p> <p>我能理解这是如何发生的。人们习惯性地使用 <code>addEventListener</code> N 次，然后还需要做一些清理工作，他们不得不调用 <code>removeEventListener</code> N 次。对 subscription 对象也进行同样的处理感觉是自然而然的，在很大程度上来说这是没错，但是还有更好的方式。<strong>保留过多的 subscription 对象是一个信号，你命令式地管理了你的 subscriptions ，并且没有利用 Rx 的强大之处。</strong></p> <h2 id="命令式的-subscription-管理看起来应该是怎样的"><a href="#命令式的-subscription-管理看起来应该是怎样的" class="header-anchor">#</a> 命令式的 subscription 管理看起来应该是怎样的</h2> <p>以这个虚构的组件为例 (我是故意使这个组件即非 React，也非 Angular，而是更通用一些):</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyGenericComponent</span> <span class="token keyword">extends</span> <span class="token class-name">SomeFrameworkComponent</span> <span class="token punctuation">{</span>
 <span class="token function">updateData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在此执行一些框架指定的操作来更新你的组件</span>
 <span class="token punctuation">}</span>

 <span class="token function">onMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dataSub <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> cancelBtn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.cancel-button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> rangeSelector <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.rangeSelector'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>cancelSub <span class="token operator">=</span> Observable<span class="token punctuation">.</span><span class="token function">fromEvent</span><span class="token punctuation">(</span>cancelBtn<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dataSub<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>rangeSub <span class="token operator">=</span> Observable<span class="token punctuation">.</span><span class="token function">fromEvent</span><span class="token punctuation">(</span>rangeSelector<span class="token punctuation">,</span> <span class="token string">'change'</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">+</span>value <span class="token operator">&gt;</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dataSub<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token function">onUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dataSub<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cancelSub<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>rangeSub<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在上面的示例中，你可以看到在 <code>onUnmount()</code> 方法中我手动地调用3个 subscription 对象的 <code>unsubscribe</code> 方法。当某人点击了取消按钮时我调用了一次 <code>this.dataSub.unsubscribe()</code>，然后当用户设置的范围选择大于500时，我又调用了一次 <code>this.dataSub.unsubscribe()</code> 。500是我想停止流的一个阈值。(我不知道为什么这样做，这是个奇怪的组件)</p> <p>这段代码的丑陋之处就在于在这个相当简单的示例中，我在多个地方命令式地管理了取消订阅。</p> <p>使用这种方式的唯一真正的优势就是性能。因为你使用了更少的抽象来完成工作，它执行起来可能会更快一些。这在大多数网络应用中不太可能有明显的效果，所以我不认为这是值得担心的。</p> <p>作为选择，你可以总是将多个 subscriptions 组合成单个 subscription，通过创建一个父 subscription 并将其他所有的 subscriptions 作为子 subscription 添加进来。但是在一天结束的时候，你仍然在做着同样的事情，你可能已经错过了这种更好的方式。</p> <h2 id="使用-takeuntil-来构成你的-subscription-管理"><a href="#使用-takeuntil-来构成你的-subscription-管理" class="header-anchor">#</a> 使用 takeUntil 来构成你的 subscription 管理</h2> <p>现在我们来做同样的基础示例，只是我们使用了 RxJS 的 <code>takeUntil</code> 操作符:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyGenericComponent</span> <span class="token keyword">extends</span> <span class="token class-name">SomeFrameworkComponent</span> <span class="token punctuation">{</span>
 <span class="token function">updateData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在此执行一些框架指定的操作来更新你的组件</span>
 <span class="token punctuation">}</span>

 <span class="token function">onMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> data$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> cancelBtn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.cancel-button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> rangeSelector <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.rangeSelector'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> cancel$ <span class="token operator">=</span> Observable<span class="token punctuation">.</span><span class="token function">fromEvent</span><span class="token punctuation">(</span>cancelBtn<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> range$ <span class="token operator">=</span> Observable<span class="token punctuation">.</span><span class="token function">fromEvent</span><span class="token punctuation">(</span>rangeSelector<span class="token punctuation">,</span> <span class="token string">'change'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   <span class="token keyword">const</span> stop$ <span class="token operator">=</span> Observable<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>cancel$<span class="token punctuation">,</span> range$<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">&gt;</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>subscription <span class="token operator">=</span> data$<span class="token punctuation">.</span><span class="token function">takeUntil</span><span class="token punctuation">(</span>stop$<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token function">onUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>首先你可能注意到的就是代码更少了。这只是其中一个好处。另外你可能注意到就是在这我有了一个组合而成的 <code>stop$</code> 事件流，它用来停止数据流。
这意味着当我决定我想要添加另外一个停止流的条件时，比如说定时器，我可以简单地合并一个新的 Observable 到 <code>stop$</code> 中。另外一件很明显的事情就是我命令式地管理的 subscription 对象只有一个。没有办法解决这个问题，因为这是函数式编程和面向对象的世界相会的地方。毕竟 JavaScript 是一种命令式语言，我们必须在某些情况下与命令式之外的编程世界相遇。</p> <p>另外一个优势是这种方式实际上完成了 observable 。这意味着会有完成事件，任何你想要杀掉你的 observalbe 的时候都可以来处理它。
如果你只是调用返回的 subscription 对象上的 <code>unsubscribe</code> 方法，那么则没有办法通知你取消订阅的发生。然而如果你使用 <code>takeUntil</code> (或下面所列出的其他操作符)，会通过你的完成处理方法通知你 observable 已经停止。</p> <p>我要指出的最后一个优势就是实际上你通过在一处调用 <code>subscribe</code> 来“连通一切”，这是有优势的，因为有了规矩，在你的代码中找到开始你的 subscriptions 的位置将变得容易得多。记住，observables 不会做任何事直到你订阅了它们，所以 subscription 所在之处是重要的代码片段。</p> <p>在 RxJS 语义方面存在一个缺点，但相对于其他优点，这几乎不值一提。语义上的不足之处在于，完成 observable 是一个信号，即生产者想要告诉消费者已经完成，而取消订阅是消费者告诉生产者它不再关心数据了。</p> <p>这种方式与只是命令式地调用 <code>unsubscribe</code> 之间还略微有点性能上的区别。然而，在大多数应用中，这种性能打击几乎是不明显的。</p> <h2 id="其他操作符"><a href="#其他操作符" class="header-anchor">#</a> 其他操作符</h2> <p>还有一些其他操作符也可以以一种更 “Rx” 的方式来停止流。我建议至少检验以下操作符:</p> <ul><li>take(n): 在停止 observable 前发出 N 个值。</li> <li>takeWhile(predicate): 通过断言函数来测试发出的值，如果一旦函数返回 <code>false</code>，则完成 observable 。</li> <li>first(): 发出首个值和完成通知。</li> <li>first(predicate): 根据断言函数检查每个值，如果函数返回 <code>true</code>，则发出值和完成通知。</li></ul> <h2 id="总结-使用-takeuntil、takewhile-及其他"><a href="#总结-使用-takeuntil、takewhile-及其他" class="header-anchor">#</a> 总结: 使用 takeUntil、takeWhile，及其他</h2> <p>你应该尽可能的使用像 <code>takeUntil</code> 这样的操作符来管理你的 RxJS subscriptions 。作为经验法则，如果你在一个组件中管理发现2个或2个以上的 subscriptions，你应该问自己是否能将它们组合的更好。</p> <ul><li>可组合性更强</li> <li>当你停止流时会触发完成事件</li> <li>通常代码更少</li> <li>需要管理的更好</li> <li>实际 subscription 的点更少 (因为调用 <code>subscribe</code> 少了)</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/articles/articles/Debugging-RxJS-Part2-Logging.html" class="prev">
        [译] 调试 RxJS 第2部分: 日志篇
      </a></span> <span class="next"><a href="/articles/articles/Hot-Vs-Cold-Observables.html">
        [译] 热的 Vs 冷的 Observables
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.de24a261.js" defer></script><script src="/assets/js/2.f6e3d3ee.js" defer></script><script src="/assets/js/26.60ae3da3.js" defer></script>
  </body>
</html>
