(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{399:function(t,s,a){t.exports=a.p+"assets/img/header.0467f536.png"},400:function(t,s,a){t.exports=a.p+"assets/img/console.36201bcd.png"},401:function(t,s,a){t.exports=a.p+"assets/img/code.dc09ef1e.png"},402:function(t,s,a){t.exports=a.p+"assets/img/result.8e234f0b.gif"},454:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"译-使用响应式编程来实现简易版的无限滚动加载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#译-使用响应式编程来实现简易版的无限滚动加载"}},[t._v("#")]),t._v(" [译] 使用响应式编程来实现简易版的无限滚动加载")]),t._v(" "),n("blockquote",[n("p",[t._v("原文链接: "),n("a",{attrs:{href:"https://hackernoon.com/naive-infinite-scroll-in-reactive-programming-using-rxjs-observables-4a605d3146e8",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://hackernoon.com/naive-infinite-scroll-in-reactive-programming-using-rxjs-observables-4a605d3146e8"),n("OutboundLink")],1)])]),t._v(" "),n("p",[n("img",{attrs:{src:a(399),alt:"header"}})]),t._v(" "),n("p",[t._v("这是一次尝试，使用 RxJS 来实现简单的无限滚动加载。")]),t._v(" "),n("p",[t._v("Angular 版本实现的文章: "),n("RouterLink",{attrs:{to:"/articles/articles/Angular-Simple-Infinite-Scroller-Directive-With-RxJS-Observables.html"}},[t._v("使用 RxJS Observables 来实现简易版的无限滚动加载指令")])],1),t._v(" "),n("h2",{attrs:{id:"什么是响应式编程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是响应式编程"}},[t._v("#")]),t._v(" 什么是响应式编程？")]),t._v(" "),n("p",[t._v("简单来说，它使用异步数据流进行编程。这有一篇 "),n("a",{attrs:{href:"https://twitter.com/andrestaltz",target:"_blank",rel:"noopener noreferrer"}},[t._v("Andre Staltz"),n("OutboundLink")],1),t._v(" 所写的超棒文章及 egghead 提供的配套视频:")]),t._v(" "),n("p",[t._v("文章: "),n("a",{attrs:{href:"https://gist.github.com/staltz/868e7e9bc2a7b8c1f754",target:"_blank",rel:"noopener noreferrer"}},[t._v("不容错过的响应式编程介绍"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("视频: "),n("a",{attrs:{href:"https://egghead.io/courses/introduction-to-reactive-programming",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://egghead.io/courses/introduction-to-reactive-programming"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"什么是-rxjs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-rxjs"}},[t._v("#")]),t._v(" 什么是 RxJS？")]),t._v(" "),n("p",[t._v("RxJS 或 Reactive Extensions 是最先由 Microsoft Open Technologies 开发的用于转换、组合和查询数据流的库。"),n("a",{attrs:{href:"https://github.com/Reactive-Extensions/RxJS",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/Reactive-Extensions/RxJS"),n("OutboundLink")],1),t._v(" (译者注: 这是 V4 版本的 RxJS)")]),t._v(" "),n("p",[t._v("这是 "),n("a",{attrs:{href:"https://twitter.com/BenLesh",target:"_blank",rel:"noopener noreferrer"}},[t._v("Ben Lesh"),n("OutboundLink")],1),t._v(" 的演讲 "),n("a",{attrs:{href:"https://www.youtube.com/watch?v=1vR9lQLfqjo&t=959s",target:"_blank",rel:"noopener noreferrer"}},[t._v("用响应式的思维来使用 RxJS 5"),n("OutboundLink")],1),t._v("，非常棒。")]),t._v(" "),n("p",[t._v("下面是 "),n("a",{attrs:{href:"https://twitter.com/NetanelBasal",target:"_blank",rel:"noopener noreferrer"}},[t._v("Netanel Basal"),n("OutboundLink")],1),t._v(" 对 Observables 和少数操作符的一些精彩介绍:")]),t._v(" "),n("ol",[n("li",[n("a",{attrs:{href:"https://netbasal.com/javascript-observables-under-the-hood-2423f760584#.ptzobjg31",target:"_blank",rel:"noopener noreferrer"}},[t._v("Observables 揭秘"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://netbasal.com/rxjs-six-operators-that-you-must-know-5ed3b6e238a0#.oqgxqivb2",target:"_blank",rel:"noopener noreferrer"}},[t._v("RxJS: 6个你必须知道的操作符"),n("OutboundLink")],1),t._v(" "),n("a",{attrs:{href:"https://github.com/RxJS-CN/rxjs-articles-translation/blob/master/articles/Six-Operators-That-You-Must-Know.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("(简体中文)"),n("OutboundLink")],1)])]),t._v(" "),n("h2",{attrs:{id:"我们要做什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#我们要做什么"}},[t._v("#")]),t._v(" 我们要做什么？")]),t._v(" "),n("p",[t._v("我们将要使用 observables 来开发一个简单的无限滚动加载。当用户滚动到指定容器高度的70%，我们就调用 API 从服务器获取更多的数据。我们会使用 "),n("a",{attrs:{href:"https://github.com/cheeaun/node-hnapi",target:"_blank",rel:"noopener noreferrer"}},[t._v("HackerNews 的非官方 API"),n("OutboundLink")],1),t._v(" 来获取最新的新闻。")]),t._v(" "),n("p",[t._v("下面是我们将使用到的 RxJS 操作符:")]),t._v(" "),n("ol",[n("li",[n("a",{attrs:{href:"http://cn.rx.js.org/class/es6/Observable.js~Observable.html#instance-method-map",target:"_blank",rel:"noopener noreferrer"}},[t._v("map"),n("OutboundLink")],1),t._v(" : 与数组的 map 类似，映射传入的数据流。")]),t._v(" "),n("li",[n("a",{attrs:{href:"http://cn.rx.js.org/class/es6/Observable.js~Observable.html#instance-method-filter",target:"_blank",rel:"noopener noreferrer"}},[t._v("filter"),n("OutboundLink")],1),t._v(" : 与数组的 filter 类似，过滤传入的数据流。")]),t._v(" "),n("li",[n("a",{attrs:{href:"http://cn.rx.js.org/class/es6/Observable.js~Observable.html#instance-method-pairwise",target:"_blank",rel:"noopener noreferrer"}},[t._v("pairwise"),n("OutboundLink")],1),t._v(" : 返回由当前发出值和前一个发出值组成的数组。")]),t._v(" "),n("li",[n("a",{attrs:{href:"http://cn.rx.js.org/class/es6/Observable.js~Observable.html#instance-method-startWith",target:"_blank",rel:"noopener noreferrer"}},[t._v("startWith"),n("OutboundLink")],1),t._v(" : 返回的 observable 会在发出源 observable 的值之前先发出提供的值。")]),t._v(" "),n("li",[n("a",{attrs:{href:"http://cn.rx.js.org/class/es6/Observable.js~Observable.html#instance-method-exhaustMap",target:"_blank",rel:"noopener noreferrer"}},[t._v("exhaustMap"),n("OutboundLink")],1),t._v(" : 只有当内部 observable 完成后，才会发出新的值。")])]),t._v(" "),n("p",[t._v("jsbin.com 上的完整示例: "),n("a",{attrs:{href:"https://output.jsbin.com/punibux",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://output.jsbin.com/punibux"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"阶段一-设置基础-html-和-css"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#阶段一-设置基础-html-和-css"}},[t._v("#")]),t._v(" 阶段一: 设置基础 html 和 css")]),t._v(" "),n("p",[t._v("导入 RxJS 库并使用 "),n("code",[t._v("infinite-scroller")]),t._v(" 作为滚动容器的 id，获取的所有新闻都将追加到此容器中。")]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token doctype"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),n("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("utf-8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("viewport"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("width=device-width"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Naive Infinite Scroller - RxJS"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://cdnjs.cloudflare.com/ajax/libs/rxjs/5.0.1/Rx.min.js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}}),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ul")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("infinite-scroller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("ul")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("div",{staticClass:"language-css extra-class"},[n("pre",{pre:!0,attrs:{class:"language-css"}},[n("code",[n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#infinite-scroller")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 500px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 700px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("border")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1px solid #f5ad7c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("overflow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" scroll"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("padding")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0"),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v(";\n  \n  li")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("padding")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10px 5px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("line-height")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1.5"),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v(";\n    &:nth-child(odd)")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("background")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" #ffe8d8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("&:nth-child(even)")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("background")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" #f5ad7c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"阶段二-设置辅助函数-用来处理数据、渲染和计算"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#阶段二-设置辅助函数-用来处理数据、渲染和计算"}},[t._v("#")]),t._v(" 阶段二: 设置辅助函数，用来处理数据、渲染和计算")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" currentPage "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getQuotesAPI")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://node-hnapi.herokuapp.com/news?page='")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" currentPage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** \n  处理 API 返回的数据\n**/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("processData")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("news")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       currentPage"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       news"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("renderNews"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** \n  \n  渲染每条信息\n**/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("renderNews")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("news")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" li "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'li'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   li"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("news"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(" - ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("news"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   scrollElem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("li"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n  检查用户是否向下滚动，通过前一个滚动位置\n  和当前滚动位置进行判断\n**/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("isUserScrollingDown")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("positions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" positions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sT "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" positions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** \n  检查滚动位置是否达到了要求的容器百分比高度\n**/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("isScrollExpectedPercent")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" percent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sT "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("percent"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("前面三个函数都很简单:")]),t._v(" "),n("ol",[n("li",[n("code",[t._v("getQuotesAPI")]),t._v("  —  返回 API 的 url，此 url 使用当前页码作为查询参数。")]),t._v(" "),n("li",[n("code",[t._v("processData")]),t._v(" —  处理 "),n("a",{attrs:{href:"https://developer.mozilla.org/en/docs/Web/API/Fetch_API",target:"_blank",rel:"noopener noreferrer"}},[t._v("fetch API"),n("OutboundLink")],1),t._v(" 返回的数据并增加当前页码。")]),t._v(" "),n("li",[n("code",[t._v("renderNews")]),t._v(" —  接收每条新闻数据并将其渲染到页面中。")])]),t._v(" "),n("p",[t._v("后面两个函数用来进行滚动计算:")]),t._v(" "),n("ol",{attrs:{start:"4"}},[n("li",[n("code",[t._v("isUserScrollingDown")]),t._v(" —  检测用户是否向下滚动。")]),t._v(" "),n("li",[n("code",[t._v("isScrollExpectedPercent")]),t._v("  —  检测用户是否已经滚动指定的百分比，从而加载更多数据。")])]),t._v(" "),n("h2",{attrs:{id:"阶段三-设置-observable-流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#阶段三-设置-observable-流"}},[t._v("#")]),t._v(" 阶段三: 设置 observable 流")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n  设置流\n**/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" scrollElem "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'infinite-scroller'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" scrollEvent$ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Rx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Observable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fromEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scrollElem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'scroll'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("要捕获容器的滚动事件，我们需要创建滚动事件的 observable 。使用 "),n("a",{attrs:{href:"http://cn.rx.js.org/class/es6/Observable.js~Observable.html#static-method-fromEvent",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("Rx.Observable.fromEvent")]),n("OutboundLink")],1),t._v(" 就可以完成。在变量结尾处加 "),n("code",[t._v("$")]),t._v(" 是一种惯例，以表示引用的是 observable 流。")]),t._v(" "),n("h2",{attrs:{id:"阶段四-编写流的逻辑-负责处理滚动事件和调用-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#阶段四-编写流的逻辑-负责处理滚动事件和调用-api"}},[t._v("#")]),t._v(" 阶段四: 编写流的逻辑，负责处理滚动事件和调用 API")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n  流的逻辑\n**/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" userScrolledDown$ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" scrollEvent$\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    sH"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scrollHeight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    sT"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scrollTop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    cH"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientHeight\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pairwise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("positions")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUserScrollingDown")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("positions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isScrollExpectedPercent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("positions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("70")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" requestOnScroll$ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" userScrolledDown$\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("startWith")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("exhaustMap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" Rx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Observable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fromPromise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getQuotesAPI")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n  订阅以产生效果\n**/")]),t._v("\nrequestOnScroll$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processData"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("我们将接收由 "),n("code",[t._v("scrollEvent")]),t._v("$ 发出的滚动事件并将其映射成无限滚动加载逻辑所需要的值。我们只取滚动元素的三个属性 : "),n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("scrollHeight")]),n("OutboundLink")],1),t._v("、 "),n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollTop",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("scrollTop")]),n("OutboundLink")],1),t._v(" 和 "),n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Element/clientHeight",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("clientHeight")]),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("p",[t._v("将映射过的数据传给 "),n("code",[t._v("pairwise")]),t._v(" 操作符，它会发出由当前值和前一个值组成的数组，如下图所示。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(400),alt:"console"}})]),t._v(" "),n("p",[t._v("现在我们将这组位置数据传给 "),n("code",[t._v("filter")]),t._v(" 操作符来根据条件进行过滤:")]),t._v(" "),n("ol",[n("li",[t._v("用户是否向下滚动")]),t._v(" "),n("li",[t._v("用户是否已经滚动到容器的70%高度")])]),t._v(" "),n("p",[t._v("当 "),n("code",[t._v("userScrollDown$")]),t._v(" 产生符合过滤条件的值后会调用 "),n("code",[t._v("requestOnScroll$")]),t._v(" 。我们给了 "),n("code",[t._v("requestOnScroll$")]),t._v(" 一个空数组作为初始值。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(401),alt:"code"}})]),t._v(" "),n("p",[t._v("我们使用 "),n("a",{attrs:{href:"http://cn.rx.js.org/class/es6/Observable.js~Observable.html#staic-method-fromPromise",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("Rx.Observable.fromPromise")]),n("OutboundLink")],1),t._v(" 来将 promise 转化成 observable 。"),n("code",[t._v("fetch")]),t._v(" 发起 http 请求并返回 promise 。"),n("code",[t._v("exhaustMap")]),t._v(" 会进行等待，直到 fetch 完成并且内部 observable 发出 API 返回的数据。")]),t._v(" "),n("p",[n("strong",[t._v("Observables 是懒加载的")]),t._v("。这意味着除非订阅了它们，它们才会执行。 我们订阅 "),n("code",[t._v("requestOnScroll$")]),t._v(" 并传入 "),n("code",[t._v("processData")]),t._v(" 作为订阅方法。当 "),n("code",[t._v("exhaustMap")]),t._v(" 发出 API 的返回数据后，数据会传给 "),n("code",[t._v("processData")]),t._v("，然后执行 "),n("code",[t._v("renderNews")]),t._v(" 将数据渲染到页面中。")]),t._v(" "),n("p",[t._v("下面的 gif 图片实际演示了无限滚动加载的效果，注意观察右边的滚动条。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(402),alt:"result"}})]),t._v(" "),n("h2",{attrs:{id:"在我的下篇文章中-我将会尝试在-angular-中创建一个无限滚动加载指令来实现它。"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在我的下篇文章中-我将会尝试在-angular-中创建一个无限滚动加载指令来实现它。"}},[t._v("#")]),t._v(" "),n("em",[t._v("在我的下篇文章中，我将会尝试在 Angular 中创建一个无限滚动加载指令来实现它。")])]),t._v(" "),n("p",[t._v("更新: 这是我下篇文章的链接 "),n("RouterLink",{attrs:{to:"/articles/articles/Angular-Simple-Infinite-Scroller-Directive-With-RxJS-Observables.html"}},[t._v("使用 RxJS Observables 来实现简易版的无限滚动加载指令")])],1)])}),[],!1,null,null,null);s.default=e.exports}}]);