(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{483:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"编写弹珠测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写弹珠测试"}},[t._v("#")]),t._v(" 编写弹珠测试")]),t._v(" "),a("p",[t._v("“弹珠测试”是使用一种叫做 "),a("code",[t._v("TestScheduler")]),t._v(" 的专用的虚拟调度器 (VirtualScheduler) 的测试。它们可以使我们以同步且可靠的方式来测试异步操作。“弹珠符号”是源自许多人的教程与文档，例如，@jhusain、@headinthebox、@mattpodwysocki 和 @staltz 。实际上，是由 @staltz 首先提出建议将其作为创建单元测试的 DSL (Domain Specific Language 领域专用语言)，并且它已经经过改造并被采纳。")]),t._v(" "),a("h4",{attrs:{id:"链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#链接"}},[t._v("#")]),t._v(" 链接")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/ReactiveX/rxjs/blob/master/CONTRIBUTING.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("贡献指南"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/ReactiveX/rxjs/blob/master/CODE_OF_CONDUCT.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("行为准则"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"基础方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础方法"}},[t._v("#")]),t._v(" 基础方法")]),t._v(" "),a("p",[t._v("单元测试添加了一些辅助方法，以使创建测试更容易。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("hot(marbles: string, values?: object, error?: any)")]),t._v(" - 创建一个“热的” Observable (Subject)，它将在测试开始时表现得\n好像已经在“运行中”了。一个有趣的不同点是 "),a("code",[t._v("hot")]),t._v(" 弹珠允许使用"),a("code",[t._v("^")]),t._v("字符来标志“零帧”所在处。这正是 Observables 订阅的起始点，\n同时也是测试的起始点。")]),t._v(" "),a("li",[a("code",[t._v("cold(marbles: string, values?: object, error?: any)")]),t._v(" - 创建一个“冷的” Observable ，当测试开始时它便开始订阅。")]),t._v(" "),a("li",[a("code",[t._v("expectObservable(actual: Observable<T>).toBe(marbles: string, values?: object, error?: any)")]),t._v(" - 当 TestScheduler flush时，   安排一个断言。在 jasmine 的 "),a("code",[t._v("it")]),t._v(" 块结束处 TestScheduler 会自动进行 flush 。")]),t._v(" "),a("li",[a("code",[t._v("expectSubscriptions(actualSubscriptionLogs: SubscriptionLog[]).toBe(subscriptionMarbles: string)")]),t._v(" -\n类似 "),a("code",[t._v("expectObservable")]),t._v(" ，当 TestScheduler flush时，安排一个断言。"),a("code",[t._v("cold()")]),t._v(" 和 "),a("code",[t._v("hot()")]),t._v(" 都返回带有"),a("code",[t._v("subscriptions")]),t._v(" 属性\n(类型为  "),a("code",[t._v("SubscriptionLog[]")]),t._v(")的 Observable 。将 "),a("code",[t._v("subscriptions")]),t._v(" 作为参数传给 "),a("code",[t._v("expectSubscriptions")]),t._v(" 以断言是否匹配在 "),a("code",[t._v("toBe()")]),t._v(" 中\n给定的 "),a("code",[t._v("expectObservable")]),t._v(" 弹珠图。Subscription 的弹珠图与 Observable 的弹珠图略有不同。详情请参见下面。")])]),t._v(" "),a("h3",{attrs:{id:"hot-和-cold-的默认行为是符合人类认知的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hot-和-cold-的默认行为是符合人类认知的"}},[t._v("#")]),t._v(" "),a("code",[t._v("hot")]),t._v(" 和 "),a("code",[t._v("cold")]),t._v(" 的默认行为是符合人类认知的")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("hot")]),t._v(" 和 "),a("code",[t._v("cold")]),t._v(" 方法中，弹珠图中指定的值的字符都会作为字符串发出，除非将 "),a("code",[t._v("values")]),t._v(" 参数传给了方法。因此：")]),t._v(" "),a("p",[a("code",[t._v("hot('--a--b')")]),t._v(" 会发出 "),a("code",[t._v('"a"')]),t._v(" 和 "),a("code",[t._v('"b"')]),t._v(" ，但")]),t._v(" "),a("p",[a("code",[t._v("hot('--a--b', { a: 1, b: 2 })")]),t._v(" 会发出 "),a("code",[t._v("1")]),t._v(" 和 "),a("code",[t._v("2")]),t._v(" 。")]),t._v(" "),a("p",[t._v("同样的，未指明的错误就只发出默认字符串 "),a("code",[t._v('"error"')]),t._v("，所以：")]),t._v(" "),a("p",[a("code",[t._v("hot('---#')")]),t._v(" 会发出错误 "),a("code",[t._v('"error"')]),t._v(" , 但")]),t._v(" "),a("p",[a("code",[t._v("hot('---#', null, new SpecialError('test'))")]),t._v(" 会发出 "),a("code",[t._v("new SpecialError('test')")]),t._v(" 。")]),t._v(" "),a("h2",{attrs:{id:"弹珠语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#弹珠语法"}},[t._v("#")]),t._v(" 弹珠语法")]),t._v(" "),a("p",[t._v("弹珠语法是用字符串表示随“时间”流逝而发生的事件。任何弹珠字符串的首字符永远都表示“零帧”。“帧”是有点类似于虚拟毫秒的概念。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v('"-"')]),t._v(" 时间: 10“帧”的时间段。")]),t._v(" "),a("li",[a("code",[t._v('"|"')]),t._v(" 完成: 表示 Observalbe 成功完成。这是 Observable 生产者所发出的 "),a("code",[t._v("complete()")]),t._v(" 信号。")]),t._v(" "),a("li",[a("code",[t._v('"#"')]),t._v(" 错误: 终止 Observable 的错误。 这是 Observable 生产者所发出的 "),a("code",[t._v("error()")]),t._v(" 信号。")]),t._v(" "),a("li",[a("code",[t._v('"a"')]),t._v(" 任意字符: 所有其他字符表示由 Observalbe 生产者所发出的 "),a("code",[t._v("next()")]),t._v(" 信号的值。")]),t._v(" "),a("li",[a("code",[t._v('"()"')]),t._v(" 同步分组: 当多个事件需要在同一帧中同步地发出，用圆括号来将这些事件聚集在一起。你可以以这种形式来聚合值、完成或错误。\n起始 "),a("code",[t._v("(")]),t._v(" 的位置决定了值发出的时间。")]),t._v(" "),a("li",[a("code",[t._v('"^"')]),t._v(" 订阅时间点: (只适用于热的 Observabe) 显示测试 Observable 订阅热的 Observable 的点。它是此 Observable 的“零帧”，在 "),a("code",[t._v("^")]),t._v("\n前的所有帧都将是无效的。")])]),t._v(" "),a("h3",{attrs:{id:"示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),a("p",[a("code",[t._v("'-'")]),t._v(" 或 "),a("code",[t._v("'------'")]),t._v(": 相当于 "),a("code",[t._v("Observable.never()")]),t._v("，或一个从不发出值或完成的 Observable")]),t._v(" "),a("p",[a("code",[t._v("|")]),t._v(": 相当于 "),a("code",[t._v("Observable.empty()")])]),t._v(" "),a("p",[a("code",[t._v("#")]),t._v(": 相当于 "),a("code",[t._v("Observable.throw()")])]),t._v(" "),a("p",[a("code",[t._v("'--a--'")]),t._v(": 此 Observable 等待20“帧”后发出值 "),a("code",[t._v("a")]),t._v(" ，然后永远不发出 "),a("code",[t._v("complete")])]),t._v(" "),a("p",[a("code",[t._v("'--a--b--|")]),t._v(": 在20帧处发出 "),a("code",[t._v("a")]),t._v("，在50帧处发出 "),a("code",[t._v("b")]),t._v("，然后在80帧处发出 "),a("code",[t._v("complete")])]),t._v(" "),a("p",[a("code",[t._v("'--a--b--#")]),t._v(": 在20帧处发出 "),a("code",[t._v("a")]),t._v("，在50帧处发出 "),a("code",[t._v("b")]),t._v("，然后在80帧处发出 "),a("code",[t._v("error")])]),t._v(" "),a("p",[a("code",[t._v("'-a-^-b--|")]),t._v(": 这是个热的 Observable ，在-20帧处发出 "),a("code",[t._v("a")]),t._v("，然后在20帧处发出 "),a("code",[t._v("b")]),t._v(" ，在50帧出发出 "),a("code",[t._v("complete")])]),t._v(" "),a("p",[a("code",[t._v("'--(abc)-|'")]),t._v(": 在20帧处发出 "),a("code",[t._v("a")]),t._v("、"),a("code",[t._v("b")]),t._v(" 和 "),a("code",[t._v("c")]),t._v("，然后在80帧处发出 "),a("code",[t._v("complete")])]),t._v(" "),a("p",[a("code",[t._v("'-----(a|)'")]),t._v(": 在50帧处发出 "),a("code",[t._v("a")]),t._v(" 和 "),a("code",[t._v("complete")])]),t._v(" "),a("h2",{attrs:{id:"subscription-的弹珠语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#subscription-的弹珠语法"}},[t._v("#")]),t._v(" Subscription 的弹珠语法")]),t._v(" "),a("p",[t._v("Subscription 的弹珠语法与常见的弹珠语法略有不同。它表示随“时间”流逝而发生的"),a("strong",[t._v("订阅")]),t._v("和"),a("strong",[t._v("取消订阅")]),t._v("的时间点。在此类图中不应该出现其他类型的事件。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v('"-"')]),t._v(" 时间: 10“帧”的时间段。")]),t._v(" "),a("li",[a("code",[t._v('"^"')]),t._v(" 订阅时间点: 显示订阅发生的时间点。")]),t._v(" "),a("li",[a("code",[t._v('"!"')]),t._v(" 取消订阅时间点: 显示取消订阅发生的时间点。")])]),t._v(" "),a("p",[t._v("在 Subscription 的弹珠语法中 "),a("code",[t._v("^")]),t._v(" 和 "),a("code",[t._v("!")]),t._v(" 时间点"),a("strong",[t._v("最多只有一个")]),t._v("。 除此之外，"),a("code",[t._v("-")]),t._v(" 字符是唯一允许出现的字符。")]),t._v(" "),a("h3",{attrs:{id:"示例-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-2"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),a("p",[a("code",[t._v("'-'")]),t._v(" 或 "),a("code",[t._v("'------'")]),t._v(": 没有订阅发生。")]),t._v(" "),a("p",[a("code",[t._v("'--^--'")]),t._v(": 在20帧处发生了订阅，并且订阅没有被取消。")]),t._v(" "),a("p",[a("code",[t._v("'--^--!-")]),t._v(": 在20帧处发生了订阅，在50帧处订阅被取消了")]),t._v(" "),a("h2",{attrs:{id:"测试剖析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试剖析"}},[t._v("#")]),t._v(" 测试剖析")]),t._v(" "),a("p",[t._v("一个基础的测试看起来应该是下面这样的：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" e1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'----a--^--b-------c--|'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" e2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'---d-^--e---------f-----|'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" expected "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'---(be)----c-f-----|'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expectObservable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("merge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("hot")]),t._v(" observables 的 "),a("code",[t._v("^")]),t._v(" 字符应该"),a("strong",[t._v("永远")]),t._v("是对齐的。")]),t._v(" "),a("li",[a("code",[t._v("cold")]),t._v(" observables 或预期 observables 的"),a("strong",[t._v("首字符")]),t._v("和 "),a("code",[t._v("hot")]),t._v(" observables 的 "),a("code",[t._v("^")]),t._v(" 应该"),a("strong",[t._v("永远")]),t._v("彼此对齐的。")]),t._v(" "),a("li",[t._v("尽量使用默认的发送值。当必要的时候才指定值 。")])]),t._v(" "),a("p",[t._v("使用指定值的测试用例：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" values "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  b"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  d"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a + c")]),t._v("\n  y"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// b + d")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" e1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'---a---b---|'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" values"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" e2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-----c---d---|'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" values"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" expected "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-----x---y---|'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expectObservable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("zip")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" values"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ul",[a("li",[t._v("使用同一个散列表来查找所有的值，这可以确保多次使用的同一个字符有着同样的值。")]),t._v(" "),a("li",[t._v("将结果值所表示的含义表达的越明显越好，毕竟这些是"),a("strong",[t._v("测试")]),t._v("，我们最想要的是代码的清晰程度，而不是执行效率，所以 "),a("code",[t._v("x: 1 + 3, // a + c")]),t._v("\n比 "),a("code",[t._v("x: 4")]),t._v(" 要好。前者传达了"),a("strong",[t._v("为什么")]),t._v("是4，而后者并没有做到这点。")])]),t._v(" "),a("p",[t._v("使用 subscription 断言的测试用例：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cold")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--a---b---c--|'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xsubs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'------^-------!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" y "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cold")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'---d--e---f---|'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ysubs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--------------^-------------!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" e1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'------x-------y------|'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" y "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" expected "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--------a---b----d--e---f---|'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expectObservable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("switch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expectSubscriptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subscriptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xsubs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expectSubscriptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subscriptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ysubs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ul",[a("li",[t._v("将 "),a("code",[t._v("xsubs")]),t._v(" 图和 "),a("code",[t._v("ysubs")]),t._v(" 图的开头与 "),a("code",[t._v("expected")]),t._v(" 图对齐。")]),t._v(" "),a("li",[t._v("注意冷的 observable "),a("code",[t._v("x")]),t._v(" 取消订阅的同时 "),a("code",[t._v("e1")]),t._v(" 发出了 "),a("code",[t._v("y")]),t._v(" 。")])]),t._v(" "),a("p",[t._v("在大多数测试中，是没有必要测试订阅时间点和取消订阅时间点的，它们要不就非常明显，要不就在 "),a("code",[t._v("expected")]),t._v(" 图中有所暗示。在这些情况下是不需要编写 subscription 断言的。在有内部 subscriptions 或冷的 observables 有多个订阅者的测试用例中，这些 subscription 断言还是有用的。")]),t._v(" "),a("h2",{attrs:{id:"基于测试生成-png-弹珠图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于测试生成-png-弹珠图"}},[t._v("#")]),t._v(" 基于测试生成 PNG 弹珠图")]),t._v(" "),a("p",[t._v("通常，Jasmine 中的测试用例都是这样写的："),a("code",[t._v("it('should do something', function () { /* ... */ })")]),t._v(" 。要想时测试用例可以用来生成 PNG 弹珠图，你必须使用 "),a("code",[t._v("asDiagram(label)")]),t._v(" 函数，像这样：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("it"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("asDiagram")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("operatorLabel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'should do something'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("举例来说，对于 "),a("code",[t._v("zip")]),t._v(" 操作符，我们可以这样写：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("it"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("asDiagram")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'zip'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'should zip by concatenating'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" e1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'---a---b---|'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" e2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-----c---d---|'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" expected "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-----x---y---|'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" values "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ac'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bd'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("zip")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expectObservable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" values"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("然后当运行 "),a("code",[t._v("npm run tests2png")]),t._v(" 时，这个测试用例会解析并且在 "),a("code",[t._v("img/")]),t._v(" 文件夹下创建一个 PNG 文件 "),a("code",[t._v("zip.png")]),t._v(" (文件名取决于 "),a("code",[t._v("${operatorLabel}.png")]),t._v(")。")])])}),[],!1,null,null,null);s.default=e.exports}}]);